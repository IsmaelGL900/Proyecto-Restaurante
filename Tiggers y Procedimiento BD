ALTER TABLE TODOALROJO_USUARIO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_PRODUCTO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_MESA ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_CARRITO ADD (fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_ITEMCARRITO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_PEDIDO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_ITEMPEDIDO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_PEDIDOTERMINADO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);
ALTER TABLE TODOALROJO_ITEMPEDIDOTERMINADO ADD (fecha_creacion TIMESTAMP DEFAULT SYSTIMESTAMP, fecha_modificacion TIMESTAMP);

-- USUARIO
CREATE OR REPLACE TRIGGER trg_usuario_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_USUARIO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- PRODUCTO
CREATE OR REPLACE TRIGGER trg_producto_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_PRODUCTO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- MESA
CREATE OR REPLACE TRIGGER trg_mesa_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_MESA
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- CARRITO
CREATE OR REPLACE TRIGGER trg_carrito_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_CARRITO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- ITEMCARRITO
CREATE OR REPLACE TRIGGER trg_itemcarrito_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_ITEMCARRITO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- PEDIDO
CREATE OR REPLACE TRIGGER trg_pedido_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_PEDIDO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- ITEMPEDIDO
CREATE OR REPLACE TRIGGER trg_itempedido_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_ITEMPEDIDO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- PEDIDOTERMINADO
CREATE OR REPLACE TRIGGER trg_pedidoterminado_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_PEDIDOTERMINADO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/

-- ITEMPEDIDOTERMINADO
CREATE OR REPLACE TRIGGER trg_itempedidoterminado_timestamps
BEFORE INSERT OR UPDATE ON TODOALROJO_ITEMPEDIDOTERMINADO
FOR EACH ROW
BEGIN
    IF INSERTING THEN
        :NEW.fecha_creacion := SYSTIMESTAMP;
    END IF;
    :NEW.fecha_modificacion := SYSTIMESTAMP;
END;
/







-- FUNCIONES

-- TABLA: TODOALROJO_USUARIO

INSERT INTO TODOALROJO_USUARIO (ID, PASSWORD, LAST_LOGIN, IS_SUPERUSER, EMAIL, NOMBRE, ROL, IS_ACTIVE, IS_STAFF, FECHA_CREACION, FECHA_MODIFICACION)
VALUES (1, 'hashed_password', NULL, 0, 'ejemplo@correo.com', 'Juan PÃ©rez', 'camarero', 1, 0, SYSDATE, NULL);

UPDATE TODOALROJO_USUARIO
SET LAST_LOGIN = SYSDATE,
    FECHA_MODIFICACION = SYSDATE
WHERE ID = 1;

DELETE FROM TODOALROJO_USUARIO WHERE ID = 1;

-- TABLA: TODOALROJO_PRODUCTO

INSERT INTO TODOALROJO_PRODUCTO (ID, NOMBRE, IMAGEN, PRECIO, TIPO, INGREDIENTES, FECHA_CREACION, FECHA_MODIFICACION)
VALUES (1, 'Pizza Margarita', 'pizza.jpg', 8.99, 'Comida', 'Tomate, Queso, Albahaca', SYSDATE, NULL);

UPDATE TODOALROJO_PRODUCTO
SET PRECIO = 9.49,
    FECHA_MODIFICACION = SYSDATE
WHERE ID = 1;

DELETE FROM TODOALROJO_PRODUCTO WHERE ID = 1;

-- TABLA: TODOALROJO_MESA

INSERT INTO TODOALROJO_MESA (ID, NUMERO, ESTADO, FECHA_CREACION, FECHA_MODIFICACION)
VALUES (1, 10, 'Libre', SYSDATE, NULL);

UPDATE TODOALROJO_MESA
SET ESTADO = 'Ocupada',
    FECHA_MODIFICACION = SYSDATE
WHERE ID = 1;

DELETE FROM TODOALROJO_MESA WHERE ID = 1;

-- TABLA: TODOALROJO_PEDIDO

INSERT INTO TODOALROJO_PEDIDO (ID, FECHA, ESTADO, TOTAL, CAMARERO_ID, CLIENTE_ID, COCINERO_ID, MESA_ID, FECHA_CREACION, FECHA_MODIFICACION)
VALUES (1, SYSDATE, 'Pendiente', 25.50, 2, 3, 4, 1, SYSDATE, NULL);

UPDATE TODOALROJO_PEDIDO
SET ESTADO = 'Completado',
    FECHA_MODIFICACION = SYSDATE
WHERE ID = 1;

DELETE FROM TODOALROJO_PEDIDO WHERE ID = 1;



CREATE TABLE TODOALROJO_TIPOPRODUCTOS(
    TIPO_COMIDA VARCHAR2(50) PRIMARY KEY,
    NUMERO_PRODUCTOS NUMBER,
    FECHA_ACTUALIZACION TIMESTAMP DEFAULT SYSTIMESTAMP
)

CREATE OR REPLACE PROCEDURE ACTUALIZAR_RESUMEN_PRODUCTOS AS
BEGIN

    DELETE FROM TODOALROJO_TIPOPRODUCTOS;
    
    
    INSERT INTO TODOALROJO_TIPOPRODUCTOS (TIPO_COMIDA, NUMERO_PRODUCTOS)
    SELECT 
        TIPO, 
        COUNT(*) 
    FROM 
        TODOALROJO_PRODUCTO
    GROUP BY 
        TIPO;

END;
/

--Ejecutar el procedimiento
EXEC ACTUALIZAR_RESUMEN_PRODUCTOS;
